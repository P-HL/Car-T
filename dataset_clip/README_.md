# è¡€æ¶²ç–¾ç—…ä¸´åºŠé¢„æµ‹åˆ†æç³»ç»Ÿ

**ç‰ˆæœ¬**: 3.0.0 (é‡æ„ç‰ˆ)  
**è¯­è¨€**: Python 3.8+  
**é¢†åŸŸ**: ä¸´åºŠæ•°æ®åˆ†æå’Œå¯è§†åŒ–

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºè¡€æ¶²ç–¾ç—…ä¸´åºŠé¢„æµ‹è€Œè®¾è®¡çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–ç³»ç»Ÿã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œæ”¯æŒåˆ†ç±»å˜é‡çš„è‡ªåŠ¨åˆ†æã€åˆ†ç»„å¯è§†åŒ–å’Œç»¼åˆæŠ¥å‘Šç”Ÿæˆã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸ” **è‡ªåŠ¨åˆ†ç±»å˜é‡åˆ†æ**: æ™ºèƒ½è¯†åˆ«å’Œåˆ†æåˆ†ç±»å˜é‡
- ğŸ“Š **åˆ†ç»„å¯è§†åŒ–**: å°†å˜é‡æŒ‰ç»„ï¼ˆæ¯ç»„5ä¸ªï¼‰è¿›è¡Œå¯è§†åŒ–
- ğŸ¨ **å¯é…ç½®å›¾è¡¨**: æ”¯æŒè‡ªå®šä¹‰é¢œè‰²ã€å°ºå¯¸å’Œå¸ƒå±€
- ğŸ“‹ **ç»¼åˆæŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆåˆ†ææŠ¥å‘Šå’Œæ•°æ®è¡¨
- âš™ï¸ **çµæ´»é…ç½®**: YAMLé…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°æ”¯æŒ
- ğŸ—ï¸ **æ¨¡å—åŒ–æ¶æ„**: æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œæ˜“äºç»´æŠ¤

## ç³»ç»Ÿæ¶æ„

```
dataset_clip/
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£å’Œå·¥ä½œæµåè°ƒ
â”œâ”€â”€ config_manager.py       # é…ç½®ç®¡ç†å’ŒéªŒè¯
â”œâ”€â”€ data_analyzer.py        # æ•°æ®åˆ†ææ ¸å¿ƒé€»è¾‘  
â”œâ”€â”€ data_visualizer.py      # æ•°æ®å¯è§†åŒ–å’Œå›¾è¡¨ç”Ÿæˆ
â”œâ”€â”€ config.yaml             # ç³»ç»Ÿé…ç½®æ–‡ä»¶
â”œâ”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ output/                 # è¾“å‡ºç›®å½•
    â”œâ”€â”€ analysis_report.txt
    â”œâ”€â”€ grouped_visualization.png
    â””â”€â”€ data_table.csv
```

### æ¨¡å—è¯´æ˜

| æ¨¡å— | èŒè´£ | ä¸»è¦åŠŸèƒ½ |
|------|------|----------|
| `main.py` | å·¥ä½œæµåè°ƒ | å‚æ•°è§£æã€é…ç½®åŠ è½½ã€æµç¨‹æ§åˆ¶ |
| `config_manager.py` | é…ç½®ç®¡ç† | YAMLåŠ è½½ã€éªŒè¯ã€é»˜è®¤å€¼å¤„ç† |
| `data_analyzer.py` | æ•°æ®åˆ†æ | åˆ†ç±»å˜é‡è¯†åˆ«ã€ç»Ÿè®¡åˆ†æã€æŠ¥å‘Šç”Ÿæˆ |
| `data_visualizer.py` | æ•°æ®å¯è§†åŒ– | åˆ†ç»„å›¾è¡¨ã€å¸ƒå±€ä¼˜åŒ–ã€æ ·å¼é…ç½® |
å·¥ä½œæµ: main â†’ config â†’ analyzer â†’ visualizer
#### æ•°æ®æµå’Œå¤„ç†é€»è¾‘ï¼š
è¾“å…¥æ•°æ® â†’ é…ç½®åŠ è½½ â†’ æ•°æ®åˆ†æ â†’ æŠ¥å‘Šç”Ÿæˆ â†’ å¯è§†åŒ–åˆ›å»º â†’ è¾“å‡ºæ–‡ä»¶

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–åŒ…
pip install pandas numpy matplotlib seaborn pyyaml

# ç¡®ä¿æ•°æ®æ–‡ä»¶å°±ä½
ls /path/to/your/encoded_standardized.csv
```

### 2. åŸºæœ¬ä½¿ç”¨

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œ
python main.py

# æŒ‡å®šè¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºç›®å½•
python main.py --input-file /path/to/data.csv --output-dir ./results

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
python main.py --config config.yaml
```

### 3. æ£€æŸ¥è¾“å‡º

```bash
ls output/
# analysis_report.txt      - è¯¦ç»†åˆ†ææŠ¥å‘Š
# grouped_visualization.png - åˆ†ç»„å¯è§†åŒ–å›¾è¡¨
# data_table.csv          - åˆ†ææ•°æ®è¡¨
```

## é…ç½®è¯´æ˜

### é…ç½®ä¼˜å…ˆçº§

ç³»ç»ŸæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§é¡ºåºåŠ è½½é…ç½®ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. **å‘½ä»¤è¡Œå‚æ•°**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. **YAMLé…ç½®æ–‡ä»¶**
3. **ç¯å¢ƒå˜é‡**
4. **é»˜è®¤å€¼**ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰

### é…ç½®æ–‡ä»¶ç»“æ„ (`config.yaml`)

```yaml
# æ•°æ®è·¯å¾„é…ç½®
data_processing:
  input_file: "/path/to/encoded_standardized.csv"
  output_dir: "./output"
  backup_input_file: "/path/to/backup.csv"  # å¤‡ç”¨æ•°æ®æ–‡ä»¶
  
# æ•°æ®åˆ†æå‚æ•°  
analysis:
  age_threshold: 65
  exclude_columns:
    - "ID"
    - "Timestamp"
    
# å¯è§†åŒ–é…ç½®
visualization:
  figure_width: 25
  figure_height: 8
  dpi: 300
  spacing: 4.0
  
  # å¸ƒå±€è¾¹è·è®¾ç½®
  top_margin: 0.92
  bottom_margin: 0.08
  left_margin: 0.08
  right_margin: 0.95
  wspace: 0.3  # å­å›¾æ°´å¹³é—´è·
  hspace: 0.4  # å­å›¾å‚ç›´é—´è·
  
  # é¢œè‰²é…ç½®
  colors:
    - "#FF6B6B"  # çŠç‘šçº¢
    - "#4ECDC4"  # é’ç»¿è‰²
    - "#45B7D1"  # å¤©è“è‰²
    - "#96CEB4"  # è–„è·ç»¿
    - "#FECA57"  # æŸ æª¬é»„
    
  # æ ·å¼è®¾ç½®
  alpha: 0.8
  grid_alpha: 0.3
  bar_width: 0.6
  category_spacing: 0.1
  variable_spacing: 0.2

# æ˜¾ç¤ºé…ç½®
display:
  fonts:
    - "Microsoft YaHei"  # ä¸­æ–‡å­—ä½“
    - "SimHei"
    - "DejaVu Sans"
    - "Arial Unicode MS"
    
  font_sizes:
    title: 16
    subtitle: 14
    axis: 12
    tick: 10

# è¾“å‡ºæ–‡ä»¶é…ç½®
output:
  report_filename: "analysis_report.txt"
  visualization_filename: "grouped_visualization.png"
  data_filename: "data_table.csv"
  encoding: "utf-8"
```

### é…ç½®éƒ¨åˆ†è¯¦è§£

#### è·¯å¾„éƒ¨åˆ† (data_processing)
- `input_file`: ä¸»è¦CSVæ•°æ®æ–‡ä»¶è·¯å¾„
- `output_dir`: ç”Ÿæˆçš„æŠ¥å‘Šå’Œå¯è§†åŒ–çš„ç›®å½•
- `backup_input_file`: å¦‚æœä¸»æ–‡ä»¶æœªæ‰¾åˆ°çš„å¤‡ç”¨æ–‡ä»¶è·¯å¾„

#### åˆ†æéƒ¨åˆ† (analysis)
- `age_threshold`: æ‚£è€…åˆ†ç»„çš„å¹´é¾„æˆªæ­¢ç‚¹ï¼ˆå¹´ï¼‰
- `exclude_columns`: ä»åˆ†æä¸­æ’é™¤çš„åˆ—ååˆ—è¡¨

#### å¯è§†åŒ–éƒ¨åˆ† (visualization)
- `figure_width/height`: å›¾è¡¨å°ºå¯¸ï¼ˆè‹±å¯¸ï¼‰
- `dpi`: å›¾åƒåˆ†è¾¨ç‡ï¼ˆé»˜è®¤ï¼š300ï¼‰
- `colors`: å›¾è¡¨å…ƒç´ çš„é¢œè‰²è°ƒè‰²æ¿
- `alpha`: æ¡å½¢é€æ˜åº¦ï¼ˆ0.0-1.0ï¼‰
- `grid_alpha`: ç½‘æ ¼çº¿é€æ˜åº¦
- `bar_width`: å•ä¸ªæ¡å½¢å®½åº¦
- `category_spacing`: ç±»åˆ«é—´è·
- `variable_spacing`: å˜é‡ç»„é—´è·
- è¾¹è·è®¾ç½®: `top_margin`, `bottom_margin`, `left_margin`, `right_margin`
- é—´è·è®¾ç½®: `wspace`ï¼ˆæ°´å¹³ï¼‰, `hspace`ï¼ˆå‚ç›´ï¼‰

#### æ˜¾ç¤ºéƒ¨åˆ† (display)
- `fonts`: å­—ä½“åå¥½åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
- `font_sizes`: ä¸åŒæ–‡æœ¬å…ƒç´ çš„å­—ä½“å¤§å°æ˜ å°„

#### è¾“å‡ºéƒ¨åˆ† (output)
- `report_filename`: æ–‡æœ¬æŠ¥å‘Šæ–‡ä»¶å
- `visualization_filename`: å›¾è¡¨å›¾åƒæ–‡ä»¶å
- `data_filename`: æ•°æ®è¡¨CSVæ–‡ä»¶å
- `encoding`: è¾“å‡ºæ–‡ä»¶çš„æ–‡æœ¬ç¼–ç 

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| `--config` | `-c` | è·¯å¾„ | é…ç½®æ–‡ä»¶è·¯å¾„ | `-c config.yaml` |
| `--input-file` | `-i` | è·¯å¾„ | è¾“å…¥CSVæ–‡ä»¶ | `-i data.csv` |
| `--output-dir` | `-o` | è·¯å¾„ | è¾“å‡ºç›®å½• | `-o ./results` |
| `--age-threshold` | `-a` | æ•´æ•° | å¹´é¾„åˆ†ç»„é˜ˆå€¼ï¼ˆé»˜è®¤ï¼š65ï¼‰ | `-a 70` |
| `--figure-width` | | æµ®ç‚¹ | å›¾è¡¨å®½åº¦ï¼ˆè‹±å¯¸ï¼Œé»˜è®¤ï¼š25ï¼‰ | `--figure-width 30` |
| `--figure-height` | | æµ®ç‚¹ | å›¾è¡¨é«˜åº¦ï¼ˆè‹±å¯¸ï¼Œé»˜è®¤ï¼š8ï¼‰ | `--figure-height 10` |
| `--dpi` | | æ•´æ•° | å›¾å½¢DPIï¼ˆé»˜è®¤ï¼š300ï¼‰ | `--dpi 150` |
| `--version` | `-v` | | æ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡º | `-v` |
| `--help` | `-h` | | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º | `-h` |

### ç¯å¢ƒå˜é‡é…ç½®

è®¾ç½®è¿™äº›ç¯å¢ƒå˜é‡æ¥é…ç½®ç³»ç»Ÿï¼š

| å˜é‡å | ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|--------|------|------|------|
| `CLIP_CONFIG_FILE` | å­—ç¬¦ä¸² | YAMLé…ç½®æ–‡ä»¶è·¯å¾„ | `export CLIP_CONFIG_FILE="config.yaml"` |
| `CLIP_INPUT_FILE` | å­—ç¬¦ä¸² | è¾“å…¥CSVæ–‡ä»¶è·¯å¾„ | `export CLIP_INPUT_FILE="data.csv"` |
| `CLIP_OUTPUT_DIR` | å­—ç¬¦ä¸² | è¾“å‡ºç›®å½•è·¯å¾„ | `export CLIP_OUTPUT_DIR="./output"` |
| `CLIP_AGE_THRESHOLD` | æ•´æ•° | å¹´é¾„åˆ†ç»„é˜ˆå€¼ | `export CLIP_AGE_THRESHOLD=70` |
| `CLIP_FIGURE_WIDTH` | æµ®ç‚¹æ•° | å›¾å½¢å®½åº¦ï¼ˆè‹±å¯¸ï¼‰ | `export CLIP_FIGURE_WIDTH=30` |
| `CLIP_FIGURE_HEIGHT` | æµ®ç‚¹æ•° | å›¾å½¢é«˜åº¦ï¼ˆè‹±å¯¸ï¼‰ | `export CLIP_FIGURE_HEIGHT=10` |
| `CLIP_DPI` | æ•´æ•° | å›¾å½¢DPI | `export CLIP_DPI=150` |

#### ç¯å¢ƒå˜é‡è®¾ç½®ç¤ºä¾‹
```bash
export CLIP_INPUT_FILE="/home/user/data/my_data.csv"
export CLIP_OUTPUT_DIR="/home/user/output"
export CLIP_AGE_THRESHOLD=70
python main.py
```

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ ‡å‡†ä¸´åºŠæ•°æ®åˆ†æ

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®åˆ†ææ ‡å‡†æ ¼å¼çš„ä¸´åºŠæ•°æ®
python main.py --input-file clinical_data.csv
```

**è¾“å‡º**:
- åˆ†ç±»å˜é‡è‡ªåŠ¨è¯†åˆ«å’Œç»Ÿè®¡
- æŒ‰å¹´é¾„ç»„(â‰¥65å², <65å²)åˆ†å±‚åˆ†æ
- æ¯ç»„5ä¸ªå˜é‡çš„å¯è§†åŒ–å›¾è¡¨

### åœºæ™¯2: è‡ªå®šä¹‰å¹´é¾„åˆ†ç»„

```bash
# å°†å¹´é¾„åˆ†ç»„é˜ˆå€¼æ”¹ä¸º70å²
python main.py --input-file clinical_data.csv --age-threshold 70
```

### åœºæ™¯3: é«˜åˆ†è¾¨ç‡å›¾è¡¨ç”Ÿæˆ

```bash
# ç”Ÿæˆé«˜åˆ†è¾¨ç‡ã€å¤§å°ºå¯¸å›¾è¡¨ç”¨äºæŠ¥å‘Š
python main.py \
  --input-file clinical_data.csv \
  --figure-width 30 \
  --figure-height 12 \
  --output-dir ./high_res_output
```

### åœºæ™¯4: æ‰¹é‡å¤„ç†é…ç½®

```yaml
# batch_config.yaml
data_processing:
  input_file: "batch_data.csv"
  output_dir: "./batch_results"

analysis:
  age_threshold: 60

visualization:
  figure_width: 35
  figure_height: 15
  dpi: 300
```

```bash
python main.py --config batch_config.yaml
```

### åœºæ™¯5: ç»„åˆé…ç½®æ–¹æ³•

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶ä½œä¸ºåŸºç¡€ï¼Œç„¶åè¦†ç›–ç‰¹å®šå€¼
python main.py --config config.yaml --age-threshold 75 --dpi 150

# ä½¿ç”¨ç¯å¢ƒå˜é‡ + å‘½ä»¤è¡Œå‚æ•°ç»„åˆ
export CLIP_INPUT_FILE="/data/clinical.csv"
export CLIP_OUTPUT_DIR="/results"
python main.py --age-threshold 70 --figure-width 20 --figure-height 14
```

## è¾“å‡ºè¯¦è§£

### 1. åˆ†ææŠ¥å‘Š (`analysis_report.txt`)

```
è¡€æ¶²ç–¾ç—…ä¸´åºŠé¢„æµ‹ - åˆ†ç±»å˜é‡åˆ†ææŠ¥å‘Š
===========================================

æ•°æ®é›†æ¦‚è¿°:
- æ€»æ ·æœ¬æ•°: 1,250
- åˆ†ç±»å˜é‡æ•°: 18
- å¹´é¾„åˆ†ç»„é˜ˆå€¼: 65å²

å¹´é¾„ç»„åˆ†å¸ƒ:
- â‰¥65å²: 723äºº (57.8%)
- <65å²: 527äºº (42.2%)

åˆ†ç±»å˜é‡åˆ†æ:
...
```

### 2. å¯è§†åŒ–å›¾è¡¨ (`grouped_visualization.png`)

- **åˆ†ç»„å¸ƒå±€**: æ¯ç»„æœ€å¤š5ä¸ªå˜é‡
- **å›¾è¡¨ç±»å‹**: å †å æ¡å½¢å›¾
- **å¹´é¾„åˆ†å±‚**: ä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒå¹´é¾„ç»„
- **é«˜åˆ†è¾¨ç‡**: 300 DPIï¼Œé€‚åˆæŠ¥å‘Šä½¿ç”¨

### 3. æ•°æ®è¡¨ (`data_table.csv`)

åŒ…å«æ‰€æœ‰åˆ†æç»“æœçš„ç»“æ„åŒ–æ•°æ®ï¼Œä¾¿äºè¿›ä¸€æ­¥å¤„ç†å’Œç»Ÿè®¡ã€‚

## é«˜çº§é…ç½®

### è‡ªå®šä¹‰é¢œè‰²ä¸»é¢˜

```yaml
visualization:
  colors:
    - "#E74C3C"  # çº¢è‰²ä¸»é¢˜
    - "#3498DB"  # è“è‰²ä¸»é¢˜
    - "#2ECC71"  # ç»¿è‰²ä¸»é¢˜
    - "#F39C12"  # æ©™è‰²ä¸»é¢˜
    - "#9B59B6"  # ç´«è‰²ä¸»é¢˜
```

### å¸ƒå±€å¾®è°ƒ

```yaml
visualization:
  # ç²¾ç¡®æ§åˆ¶å›¾è¡¨å¸ƒå±€
  top_margin: 0.95    # é¡¶éƒ¨ç•™ç™½
  bottom_margin: 0.05 # åº•éƒ¨ç•™ç™½
  left_margin: 0.06   # å·¦ä¾§ç•™ç™½
  right_margin: 0.98  # å³ä¾§ç•™ç™½
  wspace: 0.25        # å­å›¾æ°´å¹³é—´è·
  hspace: 0.35        # å­å›¾å‚ç›´é—´è·
```

### å­—ä½“å’Œæ ·å¼

```yaml
display:
  fonts:
    - "Microsoft YaHei"  # ä¸­æ–‡å­—ä½“
    - "Arial Unicode MS"
    - "DejaVu Sans"
    
  font_sizes:
    title: 16
    subtitle: 14
    axis: 12
    tick: 10
```







## æŠ€æœ¯è§„æ ¼

- **Pythonç‰ˆæœ¬**: 3.8+
- **æ ¸å¿ƒä¾èµ–**: pandas, numpy, matplotlib, seaborn, PyYAML
- **å†…å­˜éœ€æ±‚**: æœ€å°2GBï¼ˆå–å†³äºæ•°æ®å¤§å°ï¼‰
- **è¾“å‡ºæ ¼å¼**: PNGï¼ˆå›¾è¡¨ï¼‰ã€TXTï¼ˆæŠ¥å‘Šï¼‰ã€CSVï¼ˆæ•°æ®ï¼‰

## æ›´æ–°æ—¥å¿—

### v3.0.0 (å½“å‰ç‰ˆæœ¬) - 2024å¹´12æœˆ
- âœ… å®Œå…¨é‡æ„ä¸ºæ¨¡å—åŒ–æ¶æ„
- âœ… æ”¹è¿›çš„å¯è§†åŒ–å¸ƒå±€å’Œé—´è·æ§åˆ¶
- âœ… å¢å¼ºçš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼ˆæ”¯æŒä¼˜å…ˆçº§é…ç½®ï¼‰
- âœ… ä¼˜åŒ–çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… å®Œå–„çš„æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
- âœ… æ–°å¢ç¯å¢ƒå˜é‡é…ç½®æ”¯æŒ
- âœ… å¢å¼ºçš„å‘½ä»¤è¡Œå‚æ•°å¤„ç†

### v2.0.0 (æ¨¡å—åŒ–é‡æ„ç‰ˆ)
- å¼•å…¥æ¨¡å—åŒ–è®¾è®¡å’Œé…ç½®ä¼˜å…ˆçº§ç³»ç»Ÿ
- æ·»åŠ é…ç½®ç®¡ç†å™¨å’Œç¯å¢ƒå˜é‡æ”¯æŒ
- æ”¹è¿›å‘½ä»¤è¡Œç•Œé¢å’Œå‚æ•°å¤„ç†
- å¢å¼ºé”™è¯¯å¤„ç†å’Œæ–‡ä»¶å¤‡ç”¨æœºåˆ¶
- ä¿æŒå‘åå…¼å®¹æ€§

### v1.0.0 (åˆå§‹ç‰ˆæœ¬)
- åˆå§‹å•ä½“ç‰ˆæœ¬å®ç°
- åŸºæœ¬åˆ†æå’Œå¯è§†åŒ–åŠŸèƒ½
- ç®€å•é…ç½®æ–‡ä»¶æ”¯æŒ

